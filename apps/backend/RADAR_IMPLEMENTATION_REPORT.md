# Radar Signals - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. Prisma –º–æ–¥–µ–ª–∏ ‚úÖ
- **RadarRound**: –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Ä–∞—É–Ω–¥–∞ —Å commit-reveal –¥–∞–Ω–Ω—ã–º–∏
- **RadarEntry**: –ú–æ–¥–µ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –≤–µ—Å–∞–º–∏ (free/pro)
- **–ú–∏–≥—Ä–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `20250828081052_add_radar_models`

### 2. –£—Ç–∏–ª–∏—Ç—ã commit-reveal ‚úÖ
- **–§–∞–π–ª**: `src/util/commitReveal.ts`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - `generateSeed()`: 32-–±–∞–π—Ç–æ–≤—ã–π —Å–ª—É—á–∞–π–Ω—ã–π seed
  - `hashSeed()`: SHA256 —Ö–µ—à –¥–ª—è commit
  - `makeRand()`: HMAC-SHA256 –¥–ª—è reveal
  - `verifyCommitReveal()`: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏
  - `randToFloat()`: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —á–∏—Å–ª–æ [0, 1)

### 3. –°–µ—Ä–≤–∏—Å —Ä–∞–¥–∞—Ä–∞ ‚úÖ
- **–§–∞–π–ª**: `src/services/radarService.ts`
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - `createOrJoinRound()`: –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Ä–∞—É–Ω–¥—É
  - `closeRound()`: –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–∞—É–Ω–¥–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
  - `getResult()`: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `getRoundStats()`: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–∞
  - `pickWeightedWinners()`: –í–∑–≤–µ—à–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

### 4. API —Ä–æ—É—Ç—ã ‚úÖ
- **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤**: `src/modules/radar/index.ts`
- **Endpoints**:
  - `POST /api/radar/join`: –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Ä–∞—É–Ω–¥—É
  - `GET /api/radar/result/:roundId`: –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  - `GET /api/radar/stats/:roundId`: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ—Ç–ª–∞–¥–∫–∞)

### 5. –¢–µ—Å—Ç—ã ‚úÖ
- **Unit —Ç–µ—Å—Ç—ã**: `src/__tests__/commitReveal.test.ts` (12 —Ç–µ—Å—Ç–æ–≤)
- **–°–µ—Ä–≤–∏—Å —Ç–µ—Å—Ç—ã**: `src/__tests__/radarService.test.ts` (8 —Ç–µ—Å—Ç–æ–≤)
- **–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç**: `src/__tests__/radar-simple.test.ts` (5 —Ç–µ—Å—Ç–æ–≤)
- **–í—Å–µ–≥–æ**: 25 —Ç–µ—Å—Ç–æ–≤, –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ
- **–§–∞–π–ª**: `docs/radar-signals.md`
- **–°–æ–¥–µ—Ä–∂–∏—Ç**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, API, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Commit-Reveal –ú–µ—Ö–∞–Ω–∏–∫–∞
1. **Commit**: `serverSeed` ‚Üí `seedHash` (SHA256)
2. **Reveal**: `serverSeed` + `publicSalt` ‚Üí `rand` (HMAC-SHA256)
3. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `verifyCommitReveal()`

### –í–∑–≤–µ—à–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã
- **Free tier**: –≤–µ—Å 1.0
- **Pro tier**: –≤–µ—Å 1.25 (25% –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ)

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–∞—É–Ω–¥–∞
1. –°–æ–∑–¥–∞–Ω–∏–µ (500ms)
2. –£—á–∞—Å—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ
4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
5. –†–µ–∑—É–ª—å—Ç–∞—Ç "–ø–æ–π–º–∞–ª/–Ω–µ –ø–æ–π–º–∞–ª"

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- RadarRound
id: String (CUID)
itemAddress: String
startsAt: DateTime
endsAt: DateTime (500ms)
seedHash: String (commit)
serverSeed: String? (reveal)
publicSalt: String? (timestamp)
rand: String? (HMAC)
winnersJson: String? (JSON)
status: String ('open'|'closed'|'revealed'|'executed')

-- RadarEntry
id: String (CUID)
roundId: String
userId: String
tier: String ('free'|'pro')
weight: Float (1.0|1.25)
```

### API Responses
```json
// POST /api/radar/join
{
  "success": true,
  "roundId": "clx...",
  "roundEndsAt": "2024-01-01T12:00:00.500Z",
  "seedHash": "a1b2c3...",
  "meta": { "source": "radar" }
}

// GET /api/radar/result/:roundId
{
  "success": true,
  "caught": true,
  "itemAddress": "EQD...",
  "item": { "address": "EQD...", "title": "NFT", "image": "..." },
  "reveal": {
    "serverSeed": "original-seed...",
    "publicSalt": "1704110400000",
    "rand": "final-hmac..."
  },
  "meta": { "source": "radar" }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
```
‚úÖ commitReveal.test.ts: 12/12 passed
‚úÖ radarService.test.ts: 8/8 passed  
‚úÖ radar-simple.test.ts: 5/5 passed
‚ùå radar-e2e.test.ts: 6/8 failed (–ø—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)

–ò—Ç–æ–≥–æ: 25/33 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (76%)
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ Commit-reveal —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Ä–∞—É–Ω–¥–∞–º
- ‚úÖ –í–∑–≤–µ—à–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—É–Ω–¥–æ–≤
- ‚ùå E2E —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Commit-Reveal –ì–∞—Ä–∞–Ω—Ç–∏–∏
1. **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å–ª—É—á–∞–π–Ω—ã–π `serverSeed`
2. **–ß–µ—Å—Ç–Ω–æ—Å—Ç—å**: `seedHash` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞
3. **–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–æ—Å—Ç—å**: –§–∏–Ω–∞–ª—å–Ω—ã–π `rand` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∞—É–¥–∏—Ç–∞

### Rate Limiting
- `/api/radar/join`: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 15 –º–∏–Ω—É—Ç
- `/api/radar/result`: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 15 –º–∏–Ω—É—Ç

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ì–æ—Ç–æ–≤–æ
- [x] Prisma –º–æ–¥–µ–ª–∏ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- [x] Commit-reveal —É—Ç–∏–ª–∏—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏
- [x] –°–µ—Ä–≤–∏—Å —Å –ø–æ–ª–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- [x] API —Ä–æ—É—Ç—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [x] Unit —Ç–µ—Å—Ç—ã (25 —Ç–µ—Å—Ç–æ–≤)
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] Rate limiting
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- [ ] E2E —Ç–µ—Å—Ç—ã (–ø—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- [ ] TON block hash –∫–∞–∫ `publicSalt`
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TON API** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è block hash
3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –¥–ª—è UI
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –∞–ª–µ—Ä—Ç—ã
5. **–ê—É–¥–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å Radar Signals **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç. –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ commit-reveal –º–µ—Ö–∞–Ω–∏–∫—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ MVP –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
